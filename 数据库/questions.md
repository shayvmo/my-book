## 疑问汇总



**1、列举几个 MySQL 索引失效的情况？该如何优化这些情况？**



**2、MySQL 索引都有哪些？InnoDB 索引是用的什么数据结构，为什么使用这种数据结构？**



**3、MySQL 主从复制是如何实现的？如果从节点挂了，重新启动从节点，如何保持数据一致性？如何解决数据同步延迟问题？**

主从复制整个过程主要涉及三个线程：binlog 线程、I/O 线程、SQL 线程

- binlog 线程：主服务器把数据更改记录保存到二进制日志 binlog 。
- I/O 线程：从服务器把主库的binlog 复制到自己的中继日志 relay log 中。
- SQL 线程：从库读取中继日志 relay log，进行 SQL 语句重放。





**4、说说你优化 SQL 语句的几种思路有哪些？**



**5、说说 MySQL 中的锁有哪些？之间的区别？**

级别：行级锁和表级锁

| 锁                    | 描述                                                         | 级别   |
| --------------------- | ------------------------------------------------------------ | ------ |
| 排它锁 X 锁，也称写锁 | 数据对象 A 加了 X 锁后，可以对 A 进行读取和更新。加锁期间不能加任何锁 |        |
| 共享锁 S 锁，也称读锁 | 加了 S 锁后，可以进行读取操作，但是不能进行更新操作。加锁期间其他事务可以加 S 锁，但是不能加 X 锁 |        |
| 意向排它锁 IX         |                                                              | 表级锁 |
| 意向共享锁 IS         |                                                              | 表级锁 |

兼容关系

| -    | X    | IX   | S    | IS   |
| ---- | ---- | ---- | ---- | ---- |
| X    | x    | x    | x    | x    |
| IX   | x    | √    | x    | √    |
| S    | x    | x    | √    | √    |
| IS   | x    | √    | √    | √    |



**6、MySQL 中的事务了解吗？说说其 4 大特性？**

A 原子性：事务是最小的分割单元，要么全部成功，要么全部失败。

C 一致性：数据库在事务执行前后保持一致。

I 隔离性：一个事务的修改在未提交前不可见。

D 持久性：事务一旦提交后，将永久保存在数据库中。



**7、事务中隔离性，有几种情况？这几种情况分别会产生什么问题？**

| 隔离级别                  | 描述                                       | 脏读 | 不可重复读 | 幻影读 |
| ------------------------- | ------------------------------------------ | ---- | ---------- | ------ |
| Read Uncommitted 未提交读 | 事务未提交的修改，其他事务可见             | √    | √          | √      |
| Read Committed 提交读     | 事务只能读取已提交的事务的修改             | ×    | √          | √      |
| Repeatable Read 可重复读  | 同一个事务中，多次读取同样的数据，结果一样 | x    | x          | √      |
| Serializable 串行化       | 事务串行执行                               | x    | x          | x      |



**8、MySQL 中 MVVC 实现的原理是怎么样的？**

每行记录后面都保存两个隐藏的列，用于存储两个版本号：

- 创建版本号：创建行快照的时间
- 删除版本号：该快照的删除时间

两个时间，并不是实际的时间值，而是系统版本号。每开始一个新的事务，版本号自动递增。事务开始时刻的版本号作为事务的版本号，用来比对查询到的每行记录的版本号。

Repeatable Read 级别下，MVCC具体操作：

SELECT：

- 创建版本号必须小于当前事务版本号，因为如果创建版本号大于当前事务版本号的话，证明该快照数据已经被其他事务修改，也不能去读取它。
- 删除版本号必须未定义或大于当前事务版本号，因为如果小于当前版本号，证明该快照数据已被删除，不应该去读取

INSERT：

- 将当前系统版本号作为该数据快照的创建版本号

UPDATE：

- 当前系统版本号作为更新前的数据快照的删除版本号，并作为更新后数据快照的创建版本号。可以理解为，先DELETE，后执行INSERT

DELETE：

- 将当前系统版本号作为数据快照的删除版本号



快照读和当前读



**9、三大范式**

第一范式：属性不可分   1-1

第二范式：每个非主属性完全函数依赖于键码  1-n

第三范式：非主属性不传递函数依赖于键码 n-n