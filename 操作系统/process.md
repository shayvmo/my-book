## 进程管理



### 进程与线程

1、进程是资源分配的基本单位。

进程控制块 (Process Control Block, PCB) 描述进程的基本信息和运行状态，所谓的创建进程和撤销进程，都是指对 PCB 的操作。

进程控制块PCB（Process Control Block）

> 作用是使一个在多道程序环境下不能独立运行的程序成为一个能独立运行的基本单位，一个能与其他进程并发执行的进程。也就是说，操作系统是根据PCB来对并发执行的进程进行控制和管理的。



2、线程是独立调度的基本单位。

一个进程可以有多个线程，线程间共享资源。



3、区别

1）拥有资源

进程是资源分配的基本单位，线程不拥有资源，线程可以访问隶属于进程的资源。

2）调度

线程是独立调度的基本单位，同一进程中，线程的切换不会引起进程切换

3）系统开销

创建或销毁进程时，系统都要分配或回收资源，付出的开销远大于创建或撤销线程的开销。

4）通信方面

线程间可以通过直接读写同一进程的数据进行通信，但是进程通信需要通过 [IPC](#IPC)。



#### 进程特征

- 动态性：创建，调度，销毁操作
- 并发性：多个进程实体同存于内存中，同一时间内同时运行
- 独立性：进程是系统中获得资源和独立调度
- 异步性：进程各自独立运行
- 结构特征：程序段、数据段、进程控制块（PCB）





### 进程状态的切换

基本状态

- 就绪状态：等待执行
  - 进程已分配到除处理机以外的所有必要资源，等待获取处理机，获取后立刻执行。
- 执行状态
  - 进程已获得处理机，正在处理。
- 阻塞状态：等待资源
  - 进程因为发生某种事件（例如：I/O请求，申请缓冲空间）而暂停执行的状态



### 进程调度算法

调度方式：

- 非剥夺式：一旦分配处理机，直到进程完成或阻塞才把处理机分配给别的进程。
  - 紧急任务无法立即投入运行
  - 短进程周转时间长
- 剥夺式：进程正在运行时，系统可以基于某种原则剥夺已分配的处理机。
  - 优先权原则：更高优先权的进程剥夺优先权低的进程
  - 短进程优先原则
  - 时间片原则，一个时间片用完后更新调度



进程调度算法

- 先进先出 FIFO算法：优先分配最先进入就绪队列的进程
- 最短处理机运行期优先调度算法：从就绪队列中选出“下一个处理机执行期”最短的进程
- 最高响应比优先调度算法：非剥夺调度算法
- 响应比 =(等待时间+要求服务时间)/ 要求服务时间
- 优先级调度算法

  - 静态优先级：进程创建时确定
  - 动态优先级：运行过程中，动态调整
- 时间片轮转调度算法：先进先出轮流调度就绪队列中的进程。

  - 时间片内提前完成进程，系统应该提前调度
  - 进程执行过程中，I/O 请求阻塞，应当放入阻塞队列
  - 一个时间片后，进程尚未完成，应当重新放到就绪队列末尾
- 前后台调度算法：

  - 分时用户程序放在前台，批处理程序放在后台，前台使用时间片轮转调度，前台无程序时，才把处理机分配给后台
- 多级反馈队列轮转算法

  - 设置多个就绪队列，优先调度优先级高的队列，优先级高的队列为空时，再调度次高级队列
  - 可以看成是时间片轮转调度和优先级调度算法的结合



### 进程同步

1、临界区

2、同步与互斥

- 同步：多个进程因为合作产生制约关系，使得进程有先后执行顺序
- 互斥：多个进程在同一时刻只有一个进程进去临界区

3、信号量

4、管程

- 在同一时刻，只有一个进程使用管程



#### 经典同步问题

1、哲学家进餐问题

- 防止死锁

2、读者-写者问题

- 允许多个进程同时对数据进行读操作，但是不允许读和写、写和写操作同时进行



### 进程通信

和进程同步的区别：

- 进程同步：多个进程有序执行
- 进程通信：进程间数据传输



6种方式：

- 管道

  - 只支持半双工通信（单向交替传输）
  - 只能在父子进程或兄弟进程中使用

  ![](../assets/operation-system/pipe.png)

- FIFO

  > 也称为命名管道，去除了管道只能在父子进程中使用的限制

  FIFO 常用于客户-服务器应用程序中，FIFO 用作汇聚点，在客户进程和服务器进程之间传递数据。

  ![](../assets/operation-system/FIFO.png)

- 消息队列

  - 消息队列独立于读写进程存在，避免FIFO中同步管道的打开和关闭时可能产生的困难
  - 避免FIFO的同步阻塞问题，不需要进程自己提供同步方法
  - 读进程可以根据消息类型有选择地接受消息，而不像FIFO那样只能默认地接收

- 信号量

  > 计数器，用于为多个进程提供对共享数据对象的访问

- 共享存储

  - 允许多个进程共享一个存储区，最快的一种IPC
  - 需要使用信号量来同步对共享存储的访问
  - 多个进程可以将同一个文件映射到它们的地址空间从而实现共享内存

- 套接字

  > 用于不同机器间的进程通信





<span style="color: red">**注：**</span>

##### <a name="IPC">IPC（InterProcess Communication）</a>

> 进程有自己独立的地址空间，进程间需要数据交换，必须借助内核，在内核中开辟一块缓冲区，拷贝数据。



<a name="Coroutine">协程（Coroutine）</a>

> *协程是一种轻量级的线程，由用户代码来调度和管理，而不是由操作系统内核来进行调度，也就是在用户态进行。*可以直接的理解为就是一个非标准的线程实现，但什么时候切换由用户自己来实现，而不是由操作系统分配 `CPU` 时间决定。

