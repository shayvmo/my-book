## PHP7 底层设计与源码实现之 基本变量



### 基本知识

#### 结构体和联合体

**结构体**

```c
struct test{
    char a;// 1
    int b;// 4
    long c;// 8
    void* d;// 8
    int e;// 4
    char* f;// 8
}
```

这里会涉及到结构体对齐，实际是会根据机器使用等于或大于实际使用的内存，会造成一定的浪费，但是也会因为内存对齐获得更快的存取速度。



**联合体**

```c
union test{
    char a;// 1
    int b;// 4
    long c;// 8
}
```

实际使用的内存是8个字节，它复用同一块内存。



#### 堆和栈

程序执行时的内存布局主要如下：

程序的堆和栈

1）栈区（stack）——存储参数值、局部变量，维护函数调用关系等。

2）堆区（heap）——动态内存区域，随时申请和释放，程序自身要对内存泄漏负责。

3）全局区（静态区）——存储全局和静态变量。

4）字面量区——常量字符串存储区。

5）程序代码区——存储二进制代码。



接下来写一段C代码来理解一下各变量分别存在哪个段区，代码如下：

```c
int a = 0; // 全局初始化区
char *p1; // 全局未初始化区
main()
{
    static int b = 0; // 全局（静态）初始化区
    int c; // 栈
    char d[] = "abc"; // 栈
    char *p2;// 栈
    char *p3 = "hello";// hello\0 在常量区，p3 在栈
    
}
```

总体来说，栈上的变量是局部的，随着局部的空间销毁而销毁，由系统负责。

堆上的变量可以供全局访问，需要自行处理生命周期。



### 变量的类型和实现

>  `php`  中的变量使用结构体 `zval` 来表示。